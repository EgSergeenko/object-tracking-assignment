# Object Tracking Home assignment

### Установка зависимостей
```
pip install -r requirements.txt
```

### Запуск сервера
Или настройте запуск файла fastapi_server.py как приведено на скриншоте ниже 
![fastapi.png](info/fastapi.png)

или командой в терминале
```
python3 -m uvicorn fastapi_server:app --reload --port 8001 
```

### Постановка задачи

Реализуйте методы tracker_soft и tracker_strong в скрипте fastapi_server.py,
придумайте, обоснуйте и реализуйте метод для оценки качества разработанных трекеров.
Сравните результаты tracker_soft и tracker_strong для 5, 10, 20 объектов и различных 
значений random_range и bb_skip_percent
(информацию о генерации данных читай в пункте "Тестирование"). Напишите отчёт. 
В отчете необходимо в свободном стиле привести описание методов tracker_soft, 
tracker_strong, метода оценки качества трекеров, привести сравнительную таблицу 
реализованных трекеров, сделать вывод.  
Бонусом можете выписать найденные баги в текущем проекте.

### Тестирование
Для тестирования можно воспользоваться скриптом create_track.py. Скрипт генерирует
информацию об объектах и их треках. Скопируйте вывод в новый скрипт track_n.py и
скорректируйте импорт в fastapi_server.py
```
from track_n import track_data, country_balls_amount
```
Что стоит менять в скрипте create_track.py:  
**tracks_amount**: количество объектов  
**random_range**: на сколько пикселей рамка объектов может ложно смещаться (эмуляция не идеальной детекции)  
**bb_skip_percent**: с какой вероятностью объект на фрейме может быть не найдет детектором

**Soft tracker:**

На первом фрейме трекер раздает id каждому объекту по порядку (от 0 до n   1, где n – количество объектов). Для тех объектов, которые имеют координаты баундинг бокса, высчитывается центроида (функция get_centroid) и заносится в словарь в формате id: координаты центра. На выходе из функции имеем словарь с объектами и присвоенными им id, словарь id-центроида и число равное n (максимальный уже присвоенный id + 1).

На каждом последующем кадре в софт трекер передается словарь объектов с баундинг боксами, словарь id-центроида и последнее присвоенное значение id + 1. Для каждого объекта из словаря с баундинг боксами, если координаты баундинг бокса существуют, высчитывается центроида и, если словарь не пуст, выбирается id из словаря id-центроида предыдущего фрейма по наименьшему евклидову расстоянию между центроидами (функция euclidian_metric), присваивается объекту, использованный id и значение из словаря id-центроида удаляются и заносятся в новый словарь id-центроида. Если словарь id-центроида уже пуст, то объекту присваивается новый id и также заносится в новый словарь id ценроида. Если объект изначально не имел координат баундинг бокса, ему просто присваивается новый id. Значение переменной, содержащей id, инкрементируется на 1 после каждого присваивания. На выходе из функции имеем словарь с объектами и присвоенными им id, новый словарь id-центроида и число равное максимальному уже присвоенному id + 1.

Трекер показывает хорошие результаты, если данные не содержат пробелов в детекциях, однако случаи переброски id объектов между собой при близком расположении никак не обрабатываются. С увеличением пробелов в данных по детекциям объектов качество трекинга сильно ухудшается.


**Strong tracker:**

В strong tracker используется готовое решение Deep-sort-realtime. В качестве параметров были взяты для трекера (max_age=5), для получения новых треков из метода update_tracks в качестве классов был передан класс 1, в качестветве confidence=1.

Для сопоставления айди трекера и кантри бола мы измеряем минимальное евклидово расстояние от центра кантри бола и всех полученных бб трекера. Таким образом, мы получаем для каждого из кантри болов, у которых есть бб, свой айди, полученный через deep sort трекер.


**Метрики:**


Mismatch ratio - количество переходов id, деленное на общее число детекций. Для того чтобы метрика стремилась к 1, вычитаем частное из 1.
Average track coverage - максимальная доля покрытия одним id, усредненная по всем трекам.

Soft tracker для 10 объектов:

| bb_skip_percent | Avg. track coverage | Mismatch |
|-----------------|---------------------|----------|
| 0.0             | 0.676               | 0.938    |
| 10.0            | 0.314               | 0.742    |
| 20.0            | 0.273               | 0.614    |

Strong tracker для 10 объектов:
